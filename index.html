<div class="container">
    <h1>‚ú® Tu Contenido Cobra Vida ‚ú®</h1>
    <p>Hemos identificado tu hoja. Haz clic abajo para iniciar una conversaci√≥n con nuestro Asistente Experto Gemini. ¬°Recuerda usar la c√°mara una vez que inicie el chat!</p>
    
    <button id="lanzarGemini">
        ü§ñ Iniciar Conversaci√≥n con Gemini
    </button>
    
    <p class="instruccion">
        ID de la Hoja (para el Asistente): <span id="hojaDisplay">Cargando...</span>
    </p>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- INICIO: L√≥gica ultra-reforzada para leer el ID ---
        let hojaID = 'ID-NO-ENCONTRADO';
        
        // 1. Intentar leer el par√°metro de la URL (M√©todo est√°ndar)
        const urlParams = new URLSearchParams(window.location.search);
        hojaID = urlParams.get('hoja');

        // 2. Si el m√©todo est√°ndar falla (common en GitHub Pages), buscarlo manualmente
        if (!hojaID || hojaID === '') {
            const urlMatch = window.location.href.match(/[\?&]hoja=([^&]+)/);
            if (urlMatch && urlMatch[1]) {
                hojaID = urlMatch[1];
            }
        }
        
        // Asignar el ID final (o el valor de fallback)
        if (!hojaID || hojaID === '') {
            hojaID = 'ID-NO-ESPECIFICADO';
        }
        // --- FIN: L√≥gica ultra-reforzada ---

        // Mostrar el ID en la p√°gina para el diagn√≥stico
        document.getElementById('hojaDisplay').textContent = hojaID;

        // 3. Definir el Prompt
        const promptTemplate = "Hola Gemini. El usuario que ha iniciado esta conversaci√≥n ha escaneado un c√≥digo QR desde uno de nuestros productos, una hoja interactiva con el ID √∫nico: [ID_HOJA]. Tu rol es ser el Asistente Experto Multimodal sobre el contenido que el usuario te va a mostrar. Por favor, realiza lo siguiente: 1. Recon√≥ceme: Da una bienvenida confirmando que has entendido el contexto: '¬°Hola! Soy tu Asistente Experto para la hoja [ID_HOJA]. Estoy listo para ir m√°s all√° de lo que ves en el papel.' 2. Gu√≠a al Usuario: Instruye al usuario de forma clara sobre c√≥mo usar la c√°mara para que te muestre la hoja: 'Por favor, usa el bot√≥n de la c√°mara üì∑ y enfoca la hoja para que pueda ver el texto. Una vez que lo hagas, preg√∫ntame lo que desees sobre √©l: resumir, buscar informaci√≥n relacionada, obtener ideas o formular preguntas espec√≠ficas.' Tu objetivo es: Permitir cualquier interacci√≥n creativa que amplifique el contenido f√≠sico con la potencia de internet, sin limitarte a una sola funci√≥n.";

        // 4. Reemplazar y codificar
        const promptFinal = promptTemplate.replace(/\[ID_HOJA\]/g, hojaID);
        const promptCodificado = encodeURIComponent(promptFinal);

        // 5. Crear la URL de Gemini
        const urlGemini = `https://gemini.google.com/chat?prompt=${promptCodificado}`;

        // 6. Asignar la acci√≥n al bot√≥n
        document.getElementById('lanzarGemini').onclick = function() {
            window.location.href = urlGemini;
        };
    });
</script>

<style>
    /* Estilos omitidos */
</style>
